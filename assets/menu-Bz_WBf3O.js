import{b as w,g as f,O as s}from"./getPluginId-BWvJCvbn.js";import{g as y}from"./localStorage-BHjLgNnH.js";function S(e){return e.type==="SHAPE"}function R(e,o,t,a,n,l){const g=t/e.grid.dpi,u=e.image.width*g,d=e.image.height*g,p=e.grid.offset.x/e.image.width*u,i=e.grid.offset.y/e.image.height*d,c={x:e.position.x-p+u/2,y:e.position.y-i+d/2};return l.map((m,v)=>w().width(m/a*t*2).height(m/a*t*2).position(c).fillOpacity(.3-v/10).fillColor(o).strokeColor(o).strokeOpacity(1).strokeWidth(5).shapeType("CIRCLE").attachedTo(e.id).locked(!0).name("Range Ring").metadata({[f("metadata")]:{enabled:!0,name:n}}).layer("MOUNT").disableHit(!0).visible(e.visible).build())}s.onReady(async()=>{const e=y();document.querySelector("#app").innerHTML=`
    <div class="ranges-menu">
    <select class="range-select">
      <option value="none">None</option>
      ${e.map(t=>`<option value="${t.name}">${t.name}</option>`)}
      </select>
    </div>
  `,document.querySelectorAll(".range-select").forEach(t=>{t.addEventListener("change",()=>{C(t)})});const o=await s.scene.items.getItems();h(o),s.scene.items.onChange(h)});const C=async e=>{const o=await s.player.getSelection(),a=y().find(n=>n.name===e.value);if(!(!a&&e.value!=="none")&&o){const n=[],l=[],g=await s.scene.items.getItems(o),u=await s.scene.items.getItems(i=>{const c=i.metadata[f("metadata")];return!!(b(c)&&c.enabled)}),d=await s.scene.grid.getDpi(),p=await s.scene.grid.getScale();console.log(30/p.parsed.multiplier*d);for(const i of g){const c=u.filter(r=>r.attachedTo===i.id);c.length>0&&(e.value==="none"&&l.push(...c.map(r=>r.id)),e.value!==i.metadata[f("metadata")]&&l.push(...c.map(r=>r.id))),a&&n.push(...R(i,a.color,d,p.parsed.multiplier,e.value,a.ranges))}n.length>0&&(n.map(i=>console.log(i.layer)),await s.scene.items.addItems(n)),l.length>0&&await s.scene.items.deleteItems(l)}};function b(e){return e!==null&&typeof e=="object"&&e.constructor===Object}async function h(e){const o=await s.player.getSelection(),t=document.querySelectorAll(".range-select");for(const a of e){const n=a.metadata[f("metadata")];b(n)&&n.enabled&&S(a)&&a.attachedTo&&(o!=null&&o.includes(a.attachedTo))&&(t[0].value=n.name)}}
